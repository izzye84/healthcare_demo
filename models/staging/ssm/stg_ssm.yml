version: 2

models:
  - name: stg_ssm__member
    description: Staging step for SSM members
    columns:
      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: name_given_first
        description: Member first name

      - name: name_given_middle
        description: Member middle name

      - name: name_family
        description: Member last name

      - name: identifier_social_security_number
        description: Member social security number

      - name: birth_date
        description: Member birth date
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: identifier_external_subscriber_id
        description: Member SSM assigned patient ID

      - name: gender
        description: Member gender
        tests:
          - accepted_values:
              values: ['M','F','U']

      - name: race
        description: Member race
        tests:
          - accepted_values:
              values: ['Unknown','White','Black or African American','Other Race','Asian','Hispanic','American Indian or Alaska Native']

      - name: ethnic_group
        description: Member ethnic group

      - name: telecom_phone_number_home
        description: Member home phone number

      - name: telecom_email_address
        description: Member email address

      - name: address_line1
        description: Member address line 1

      - name: address_line2
        description: Member address line 2

      - name: address_city
        description: Member address city

      - name: address_state
        description: Member address state

      - name: address_postal_code
        description: Member address postal code

      - name: general_practitioner
        description: Member primary care physician

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: ['ssm']

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_ssm__patient
    description: Staging step for SSM Patients
    columns:
      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: identifier_social_security_number
        description: Patient social security number

      - name: name_given_first
        description: Patient first name

      - name: name_family
        description: Patient last name

      - name: name_given_nickname
        description: Patient preferred name

      - name: name_prefix
        description: Patient name prefix

      - name: birth_date
        description: Patient birth date

      - name: gender
        description: Patient gender
        tests:
          - accepted_values:
              values: ['M','F','U']

      - name: race
        description: Patient race
        tests:
          - accepted_values:
              values: ['Unknown','White','Black or African American','Other Race','Asian','Hispanic','American Indian or Alaska Native']

      - name: language_preferred
        description: Patient primary spoken language

      - name: language_secondary
        description: Patient secondary language spoken

      - name: deceased_date
        description: Patient deceased date

      - name: birth_country
        description: Patient country of birth

      - name: address_line1
        description: Patient address line 1

      - name: address_line2
        description: Patient address line 2

      - name: address_city
        description: Patient address city

      - name: address_state
        description: Patient address state

      - name: address_postal_code
        description: Patient address postal code

      - name: address_country
        description: Patient address country

      - name: telecom_phone_number_home
        description: Patient phone number

      - name: telecom_email_address
        description: Patient email address

      - name: general_practitioner
        description: Patient primary care physician

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: ['ssm']

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_ssm__eligibility
    description: Staging step for SSM eligibility
    columns:
      - name: identifier
        description: Unique identifier for the most recent insurance coverage of a Member
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: status
        description: Status of the most recent insurance coverage of a Member (e.g. active, cancelled)
        tests:
          - accepted_values:
              values: ['active','cancelled']

      - name: period_coverage_start
        description: Coverage start date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd

      - name: period_coverage_end
        description: Coverage end date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd

      - name: subscriber_id
        description: ID assigned to the subscriber. This can be linked to the `person_id` in `member_crosswalk`
        tests:
          - not_null

      - name: relationship
        description: Member relationship to insurance policy holder

      - name: network
        description: Insurer network
        tests:
          - not_null

      - name: payor
        description: Insurer of the policy
        tests:
          - not_null

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_ssm__clinical_diagnoses
    description: Staging step for SSM clinical diagnoses
    columns:
      - name: identifier
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Unique ID for a clinical encounter where diagnosis was made
        tests:
          - not_null

      - name: recorded_date
        description: Date the diagnosis was recorded

      - name: code
        description: Diagnosis code
        tests:
          - not_null

      - name: code_system
        description: The coding system used to define the diagnosis code (e.g. ICD-10)

      - name: onset_datetime
        description: Estimated or actual date, date-time the diagnosis started
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: abatement_datetime
        description: Date when diagnosis was in resolution/remission
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_ssm__clinical_procedure
    description: Base SSM Clinical Procedure
    columns:
      - name: identifier
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Clinical encounter ID

      - name: code
        description: Procedure code
        tests:
          - not_null

      - name: code_system
        description: Code system that defines the procedure code

      - name: performed_datetime
        description: When the procedure was performed
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS
              date_type: timestamp

  - name: stg_ssm__claim_header
    description: Add missing columns to SSM's claim header data
    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.
        tests:
          - unique
          - not_null

      - name: type
        description: The category of claim, e.g. oral, pharmacy, vision, institutional, professional.

      - name: sub_type
        description: A finer grained suite of claim type codes which may convey additional information such as Inpatient vs Outpatient and/or a specialty service.

      - name: patient
        description: The party to whom the professional services and/or products have been supplied or are being considered and for whom actual or forecast reimbursement is sought.

      - name: billable_period_start
        description: The period for which charges are being submitted.

      - name: billable_period_end
        description: The period for which charges are being submitted.

      - name: insurer
        description: The Insurer who is target of the request.

      - name: provider
        description: The provider which is responsible for the claim, predetermination or preauthorization.

      - name: facility
        description: Facility where the services were provided.

      - name: total
        description: The total value of the all the items in the claim.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_ssm__claim_line
    description: Add missing columns to SSM's claim line data
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_claim_header
            - identifier_claim_line
    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.

      - name: identifier_claim_line
        description: A number to uniquely identify item entries.

      - name: revenue
        description: The type of revenue or cost center providing the product and/or service.

      - name: product_or_service
        description: When the value is a group code then this item collects a set of related claim details, otherwise this contains the product, service, drug or other billing code for the item.

      - name: modifier_1
        description: Item typification or modifiers codes to convey additional context for the product or service.

      - name: modifier_2
        description: Item typification or modifiers codes to convey additional context for the product or service.

      - name: serviced_period_start
        description: The date or dates when the service or product was supplied, performed or completed.

      - name: serviced_period_end
        description: The date or dates when the service or product was supplied, performed or completed.

      - name: location
        description: Where the product or service was provided.

      - name: quantity
        description: The number of repetitions of a service or product.

      - name: unit_price
        description: The amount charged to the patient by the provider for a single unit.

      - name: net
        description: The quantity times the unit price for an additional service or product or charge.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_ssm__pharmacy_claims
    description: Add missing columns to SSM's pharmacy_claim data
    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.
        tests:
          - not_null
          - unique

      - name: type
        description: The category of claim, e.g. oral, pharmacy, vision, institutional, professional.

      - name: sub_type
        description: A finer grained suite of claim type codes which may convey additional information such as Inpatient vs Outpatient and/or a specialty service.

      - name: patient
        description: The party to whom the professional services and/or products have been supplied or are being considered and for whom actual or forecast reimbursement is sought.

      - name: billable_period_start
        description: The period for which charges are being submitted.

      - name: billable_period_end
        description: The period for which charges are being submitted.

      - name: insurer
        description: The Insurer who is target of the request.

      - name: provider
        description: The provider which is responsible for the claim, predetermination or preauthorization.

      - name: facility
        description: Facility where the services were provided.

      - name: total
        description: The total value of the all the items in the claim.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_ssm__clinical_encounters
    description: Staging step for SSM clinical encounters
    columns:
      - name: identifier_encounter
        description: Unique identifier for a patients encounter
        tests:
          - not_null
          - unique

      - name: identifier_external_encounter
        description: identifier_external_encounter

      - name: status
        description: status

      - name: type
        description: type

      - name: service_type
        description: service_type

      - name: subject
        description: subject
        tests:
          - not_null

      - name: period
        description: period

      - name: reason_code_text
        description: reason_code_text

      - name: service_provider
        description: service_provider

      - name: client_id
        description: client_id

      - name: ingest_date
        description: ingest_date

  - name: stg_ssm__lab_order
    description: Staging step to extract order data from SSM labs results
    columns:
      - name: identifier_order
        description: Surrogate key for the order made from various external source IDs
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key for the patient made from various external source IDs

      - name: reason_code
        description: Why the order was made

      - name: reason_display
        description: Display value

      - name: reason_system
        description: Coding system

      - name: detail
        description: What action is being ordered

      - name: order_date
        description: When the order was made

      - name: ingest_date
        description: Most recent ingest date

      - name: client_id
        description: Strive client ID

  - name: stg_ssm__lab_observation
    description: Staging step to map SSM lab results to observations for labs that have been coded to the Strive Lab Code System
    columns:
      - name: identifier_observation
        description: Surrogate key for the result made from various external source IDs
        tests:
          - not_null
          - unique

      - name: identifier_order
        description: Surrogate key for the order made from various external source IDs

      - name: identifier_external_source
        description: Surrogate key for the patient made from various external source IDs

      - name: identifier_encounter
        description: Related clinical encounter

      - name: status_code
        description: The status of the result value

      - name: status_display
        description: Display value

      - name: status_system
        description: Coding system

      - name: category_code
        description: A code that classifies the general type of observation being made

      - name: category_display
        description: Display value

      - name: category_system
        description: Coding system

      - name: code_source
        description: Source code that classifies the general type of observation being made

      - name: code_source_display
        description: Display value

      - name: code_source_system
        description: Coding system

      - name: code_strive
        description: Strive's coded concept that classifies the general type of observation being made

      - name: code_strive_display
        description: Display value

      - name: code_strive_system
        description: Coding system

      - name: value_quantity
        description: The information determined as a result of making the observation, if the information has a simple value

      - name: value_quantity_unit
        description: Unit of measure for the value_quantity

      - name: value_string
        description: The information determined as a result of making the observation, if the information is a string

      - name: value_boolean
        description: The information determined as a result of making the observation, if the information is a boolean

      - name: interpretation_code
        description: A categorical assessment of an observation value

      - name: interpretation_display
        description: Display value

      - name: interpretation_system
        description: Coding system

      - name: reference_range_low
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, low range

      - name: reference_range_high
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, high range

      - name: reference_range_text
        description: Guidance on how to interpret the value by comparison to a normal or recommended range

      - name: effective_date
        description: Clinically relevant time/time-period for observation

      - name: issued_date
        description: Date/Time this version was made available

      - name: ingest_date
        description: Most recent ingest date

      - name: client_id
        description: Strive client ID
