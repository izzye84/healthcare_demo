version: 2

models:
  - name: stg_humana__referral
    description: Staging step for Humana referrals

    columns:
      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: identifier_external_subscriber_id
        description: Humana member ID. Also referred to as `mbr_pers_gen_key` or `pers_gen_key`
        tests:
          - not_null

      - name: name_given_first
        description: Member first name
        tests:
          - not_null

      - name: name_family
        description: Member last name
        tests:
          - not_null

      - name: birth_date
        description: Member birth date
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: gender
        description: Member gender
        tests:
          - accepted_values:
              values: ['M','F','U']

      - name: telecom_phone_number_home
        description: Member home phone number

      - name: telecom_phone_number_work
        description: Member work phone number

      - name: telecom_email_address
        description: Member email address

      - name: address_line1
        description: Member address line 1

      - name: address_line2
        description: Member address line 2

      - name: address_city
        description: Member address city

      - name: address_state
        description: Member address state

      - name: address_postal_code
        description: Address postal code

      - name: address_district
        description: Address county

      - name: general_practitioner
        description: Member primary care physician (PCP)

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: ['humana']

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_humana__patient_demographics
    description: Staging step for Humana patient demographics

    columns:
      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: deceased_date
        description: Patient deceased date
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: ['humana']

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_humana__eligibility
    description: Staging step for Humana eligibility

    columns:
      - name: identifier
        description: Unique identifier for the most recent insurance coverage of a Member
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null
          - unique

      - name: status
        description: Status of the most recent insurance coverage of a Member (e.g. active, cancelled)
        tests:
          - accepted_values:
              values: ['active','cancelled']

      - name: period_coverage_start
        description: Coverage start date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd

      - name: period_coverage_end
        description: Coverage end date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd

      - name: subscriber_id
        description: ID assigned to the subscriber. This can be linked to the `mbr_pers_gen_key` in `referral`
        tests:
          - not_null

      - name: relationship
        description: Member relationship to insurance policy holder

      - name: network
        description: Insurer network
        tests:
          - not_null

      - name: payor
        description: Insurer of the policy
        tests:
          - not_null

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['humana']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_humana__claim_header
    description: Add missing columns to Humana's claim header data

    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.
        tests:
          - not_null
          - unique

      - name: type
        description: The category of claim, e.g. oral, pharmacy, vision, institutional, professional.

      - name: sub_type
        description: A finer grained suite of claim type codes which may convey additional information such as Inpatient vs Outpatient and/or a specialty service.

      - name: patient
        description: The party to whom the professional services and/or products have been supplied or are being considered and for whom actual or forecast reimbursement is sought.

      - name: billable_period_start
        description: The period for which charges are being submitted.

      - name: billable_period_end
        description: The period for which charges are being submitted.

      - name: insurer
        description: The Insurer who is target of the request.

      - name: provider
        description: The provider which is responsible for the claim, predetermination or preauthorization.

      - name: facility
        description: Facility where the services were provided.

      - name: total
        description: The total value of the all the items in the claim.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_humana__claim_line
    description: Add missing columns to Humana's claim line data
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_claim_header
            - identifier_claim_line

    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.

      - name: identifier_claim_line
        description: A number to uniquely identify item entries.

      - name: revenue
        description: The type of revenue or cost center providing the product and/or service.

      - name: product_or_service
        description: When the value is a group code then this item collects a set of related claim details, otherwise this contains the product, service, drug or other billing code for the item.

      - name: modifier_1
        description: Item typification or modifiers codes to convey additional context for the product or service.

      - name: modifier_2
        description: Item typification or modifiers codes to convey additional context for the product or service.

      - name: serviced_period_start
        description: The date or dates when the service or product was supplied, performed or completed.

      - name: serviced_period_end
        description: The date or dates when the service or product was supplied, performed or completed.

      - name: location
        description: Where the product or service was provided.

      - name: quantity
        description: The number of repetitions of a service or product.

      - name: unit_price
        description: The amount charged to the patient by the provider for a single unit.

      - name: net
        description: The quantity times the unit price for an additional service or product or charge.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_humana__pharmacy_claims
    description: Add missing columns to Humana's claim header data

    columns:
      - name: identifier_claim_header
        description: A unique identifier assigned to this claim.
        tests:
          - not_null
          - unique

      - name: type
        description: The category of claim, e.g. oral, pharmacy, vision, institutional, professional.

      - name: sub_type
        description: A finer grained suite of claim type codes which may convey additional information such as Inpatient vs Outpatient and/or a specialty service.

      - name: patient
        description: The party to whom the professional services and/or products have been supplied or are being considered and for whom actual or forecast reimbursement is sought.

      - name: billable_period_start
        description: The period for which charges are being submitted.

      - name: billable_period_end
        description: The period for which charges are being submitted.

      - name: insurer
        description: The Insurer who is target of the request.

      - name: provider
        description: The provider which is responsible for the claim, predetermination or preauthorization.

      - name: facility
        description: Facility where the services were provided.

      - name: total
        description: The total value of the all the items in the claim.

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Most recent ingest date

  - name: stg_humana__claim_diagnoses
    description: Staging step for Humana clinical diagnoses

    columns:
      - name: identifier_condition
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Unique ID for a clinical encounter where diagnosis was made
        tests:
          - not_null

      - name: recorded_date
        description: Date the diagnosis was recorded

      - name: category_code
        description: A code that classifies the type of condition——e.g., claim or clinical

      - name: code
        description: Diagnosis code
        tests:
          - not_null

      - name: code_system
        description: The coding system used to define the diagnosis code (e.g. ICD-10)

      - name: onset_datetime
        description: Estimated or actual date, date-time the diagnosis started

      - name: abatement_datetime
        description: Date when diagnosis was in resolution/remission

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['humana']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: stg_humana__lab_observation
    description: Staging step for Humana lab results to observations for labs that have been coded to the Strive Lab Code System

    columns:
      - name: identifier_observation
        description: Surrogate key for the result made from various external source IDs
        tests:
          - not_null
          - unique

      - name: identifier_order
        description: Placeholder, not applicable for Humana

      - name: identifier_external_source
        description: Surrogate key for the patient made from various external source IDs
        tests:
          - not_null

      - name: identifier_encounter
        description: Placeholder, not applicable for Humana

      - name: status_code
        description: Placeholder, not applicable for Humana

      - name: status_display
        description: Placeholder, not applicable for Humana

      - name: status_system
        description: Placeholder, not applicable for Humana

      - name: category_code
        description: A code that classifies the general type of observation being made

      - name: category_display
        description: Display value

      - name: category_system
        description: Coding system

      - name: code_source
        description: Source code that classifies the general type of observation being made

      - name: code_source_display
        description: Placeholder, not applicable for Humana

      - name: code_source_system
        description: Placeholder, not applicable for Humana

      - name: code_strive
        description: Strive's coded concept that classifies the general type of observation being made

      - name: code_strive_display
        description: Display value

      - name: code_strive_system
        description: Coding system

      - name: value_quantity
        description: The information determined as a result of making the observation, if the information has a simple value
        tests:
          - not_null

      - name: value_quantity_unit
        description: Unit of measure for the value_quantity

      - name: value_string
        description: The information determined as a result of making the observation, if the information is a string

      - name: value_boolean
        description: Placeholder, not applicable for Humana

      - name: interpretation_code
        description: Placeholder, not applicable for Humana

      - name: interpretation_display
        description: Placeholder, not applicable for Humana

      - name: interpretation_system
        description: Placeholder, not applicable for Humana

      - name: reference_range_low
        description: Placeholder, not applicable for Humana

      - name: reference_range_high
        description: Placeholder, not applicable for Humana

      - name: reference_range_text
        description: Placeholder, not applicable for Humana

      - name: effective_date
        description: Clinically relevant time/time-period for observation
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: issued_date
        description: Date/Time this version was made available
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: [ 'humana' ]

  - name: stg_humana__claim_encounters
    description: Staging step for Humana claim encounters
    columns:
      - name: identifier_encounter
        description: Unique identifier for a patients encounter
        tests:
          - not_null
          - unique

      - name: identifier_external_encounter
        description: identifier_external_encounter

      - name: hospitalization_admit_source
        description: hospitalization_admit_source

      - name: hospitalization_discharge_disposition_code
        description: hospitalization_discharge_disposition_code

      - name: status
        description: status

      - name: type
        description: type

      - name: service_type_code
        description: service_type_code

      - name: subject
        description: subject
        tests:
          - not_null

      - name: period
        description: period

      - name: reason_code_text
        description: reason_code_text

      - name: participant_individual
        description: participant_individual

      - name: service_provider
        description: service_provider

      - name: client_id
        description: client_id

      - name: ingest_date
        description: ingest_date
