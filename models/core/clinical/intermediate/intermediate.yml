version: 2

models:
  - name: observation__unioned
    description: Consolidate client observation data into a single dataset
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_observation
            - client_id
    columns:
      - name: identifier_observation
        description: Unique identifier for the distinct observation for a patient
        tests:
          - not_null

      - name: identifier_order
        description: Unique identifier for the distinct order for an observation, references the order table

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs

      - name: identifier_encounter
        description: Related clinical encounter

      - name: status_code
        description: The status of the result value

      - name: status_display
        description: Display value

      - name: status_system
        description: Coding system

      - name: category_code
        description: A code that classifies the general type of observation being made

      - name: category_display
        description: Display value

      - name: category_system
        description: Coding system

      - name: code_source
        description: Source code that classifies the general type of observation being made

      - name: code_source_display
        description: Display value

      - name: code_source_system
        description: Coding system

      - name: code_strive
        description: Strive's coded concept that classifies the general type of observation being made

      - name: code_strive_display
        description: Display value

      - name: code_strive_system
        description: Coding system

      - name: value_quantity
        description: The information determined as a result of making the observation, if the information has a simple value

      - name: value_quantity_unit
        description: Unit of measure for the value_quantity

      - name: value_string
        description: The information determined as a result of making the observation, if the information is a string

      - name: value_boolean
        description: The information determined as a result of making the observation, if the information is a boolean

      - name: interpretation_code
        description: A categorical assessment of an observation value

      - name: interpretation_display
        description: Display value

      - name: interpretation_system
        description: Coding system

      - name: reference_range_low
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, low range

      - name: reference_range_high
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, high range

      - name: reference_range_text
        description: Guidance on how to interpret the value by comparison to a normal or recommended range

      - name: effective_date
        description: Clinically relevant time/time-period for observation

      - name: issued_date
        description: Date/Time this version was made available

      - name: ingest_date
        description: Most recent ingest date

      - name: client_id
        description: Strive client ID
        tests:
          - not_null

  - name: order__filtered
    description: Filter order data to Strive lab concepts from observation stage
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_order
            - client_id
    columns:
      - name: identifier_order
        description: Unique identifier for the distinct order for a patient
        tests:
          - not_null

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs

      - name: reason_code
        description: Why the order was made

      - name: reason_display
        description: Display value

      - name: reason_system
        description: Coding system

      - name: detail
        description: What action is being ordered

      - name: order_date
        description: When the order was made

      - name: ingest_date
        description: Most recent ingest date

      - name: client_id
        description: Strive client ID
        tests:
          - not_null

  - name: int_conditions__unioned
    description: Consolidate client condition data into a single dataset
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_condition
            - client_id
    columns:
      - name: identifier_condition
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Unique ID for a clinical encounter where diagnosis was made
        tests:
          - not_null

      - name: recorded_date
        description: Date the diagnosis was recorded

      - name: category_code
        description: A code that classifies the type of condition——e.g., claim or clinical
        tests:
          - accepted_values:
              values: ['claim',
                       'clinical']

      - name: code
        description: Diagnosis code
        tests:
          - not_null

      - name: code_system
        description: The coding system used to define the diagnosis code (e.g. ICD-10)

      - name: onset_datetime
        description: Estimated or actual date, date-time the diagnosis started

      - name: abatement_datetime
        description: Date when diagnosis was in resolution/remission

      - name: client_id
        description: Strive client ID

      - name: ingest_date
        description: Strive ingest date

  - name: int_encounters__unioned
    description: Consolidate client encounters data into a single dataset
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_encounter
            - client_id
    columns:
      - name: identifier_encounter
        description: Identifier(s) by which this encounter is known.
        tests:
          - not_null

      - name: identifier_external_encounter
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: hospitalization_admit_source
        description: From where patient was admitted (physician referral, transfer).

      - name: hospitalization_discharge_disposition_code
        description: Category or kind of location after discharge.

      - name: status
        description: planned, arrived, triaged, in-progress, onleave, finished, cancelled +.

      - name: type
        description: Specific type of encounter——clinical or claim.

      - name: service_type_code
        description: Broad categorization of the service that is to be provided (e.g. cardiology).

      - name: subject
        description: The patient or group present at the encounter.

      - name: period
        description: The start and end time of the encounter.

      - name: reason_code_text
        description: Reason the encounter takes place. For admissions, this can be used for a coded admission diagnosis.

      - name: participant_individual
        description: Persons involved in the encounter other than the patient.

      - name: client_id
        description: client_id

      - name: ingest_date
        description: ingest_date

  - name: int_procedures__unioned
    description: An action that is or was performed on or for a patient. This can be a physical intervention like an operation, or less invasive like long term services, counseling, or hypnotherapy.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier
            - client_id
    columns:
      - name: identifier
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Clinical encounter ID

      - name: category_code
        description: A code that classifies the type of condition——e.g., claim or clinical

      - name: code
        description: Procedure code
        tests:
          - not_null

      - name: code_system
        description: Code system that defines the procedure code

      - name: performed_datetime
        description: When the procedure was performed
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm', 'humana']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS
              date_type: timestamp
