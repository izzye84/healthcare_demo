version: 2

models:
  - name: condition
    description: A clinical condition, problem, diagnosis, or other event, situation, issue, or clinical concept that has risen to a level of concern.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_condition
            - client_id
    columns:
      - name: identifier_condition
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Encounter created as part of
        tests:
          - not_null

      - name: recorded_date
        description: Date record was first recorded

      - name: category_code
        description: A code that classifies the type of condition——e.g., claim or clinical

      - name: code
        description: Identification of the condition, problem or diagnosis
        tests:
          - not_null

      - name: code_system
        description: The coding system used to define the condition code (e.g. ICD-10)

      - name: onset_datetime
        description: Estimated or actual date, date-time the condition started
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: abatement_datetime
        description: Date when condition was in resolution/remission
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm',
                         'humana']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS

  - name: procedure
    description: An action that is or was performed on or for a patient. This can be a physical intervention like an operation, or less invasive like long term services, counseling, or hypnotherapy.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier
            - client_id
    columns:
      - name: identifier
        description: Unique identifier for the distinct diagnosis for a patient
        tests:
          - not_null

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: encounter
        description: Clinical encounter ID

      - name: category_code
        description: A code that classifies the type of condition——e.g., claim or clinical

      - name: code
        description: Procedure code
        tests:
          - not_null

      - name: code_system
        description: Code system that defines the procedure code

      - name: performed_datetime
        description: When the procedure was performed
        tests:
          - is_date:
              date_format: yyyy-mm-dd

      - name: client_id
        description: Strive client ID
        tests:
            - not_blank
            - accepted_values:
                values: ['ssm', 'humana']

      - name: ingest_date
        description: Strive ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS
              date_type: timestamp

  - name: encounter
    description: An interaction between a patient and healthcare provider(s) for the purpose of providing healthcare service(s) or assessing the health status of a patient.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - identifier_encounter
            - client_id
    columns:
      - name: identifier_encounter
        description: Identifier(s) by which this encounter is known.
        tests:
          - not_null

      - name: identifier_external_encounter
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: hospitalization_admit_source
        description: From where patient was admitted (physician referral, transfer).

      - name: hospitalization_discharge_disposition_code
        description: Category or kind of location after discharge.

      - name: status
        description: planned, arrived, triaged, in-progress, onleave, finished, cancelled +.

      - name: type
        description: Specific type of encounter——clinical or claim.

      - name: service_type_code
        description: Broad categorization of the service that is to be provided (e.g. cardiology).

      - name: subject
        description: The patient or group present at the encounter.

      - name: period
        description: The start and end time of the encounter.

      - name: reason_code_text
        description: Reason the encounter takes place. For admissions, this can be used for a coded admission diagnosis.

      - name: service_provider
        description: The organization that is primarily responsible for this Encounter's services. This MAY be the same as the organization on the Patient record, however it could be different, such as if the actor performing the services was from an external organization (which may be billed seperately) for an external consultation. Refer to the example bundle showing an abbreviated set of Encounters for a colonoscopy.

      - name: client_id
        description: client_id

      - name: ingest_date
        description: ingest_date

  - name: order
    description: A request to perform an action.
    columns:
      - name: identifier_order
        description: Unique identifier for the distinct order for a patient
        tests:
          - not_null
          - unique

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: reason_code
        description: Why the order was made

      - name: reason_display
        description: Display value

      - name: reason_system
        description: Coding system

      - name: detail
        description: What action is being ordered

      - name: order_date
        description: When the order was made

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS
              date_type: timestamp

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: [ 'ssm' ]

  - name: observation
    description: Measurements and simple assertions made about a patient, device or other subject.
    columns:
      - name: identifier_observation
        description: Unique identifier for the distinct observation for a patient
        tests:
          - not_null
          - unique

      - name: identifier_order
        description: Unique identifier for the distinct order for an observation, references the order table

      - name: identifier_external_source
        description: Surrogate key made from various external source IDs
        tests:
          - not_null

      - name: identifier_encounter
        description: Related clinical encounter

      - name: status_code
        description: The status of the result value

      - name: status_display
        description: Display value

      - name: status_system
        description: Coding system

      - name: category_code
        description: A code that classifies the general type of observation being made

      - name: category_display
        description: Display value

      - name: category_system
        description: Coding system

      - name: code_source
        description: Source code that classifies the general type of observation being made

      - name: code_source_display
        description: Display value

      - name: code_source_system
        description: Coding system

      - name: code_strive
        description: Strive's coded concept that classifies the general type of observation being made

      - name: code_strive_display
        description: Display value

      - name: code_strive_system
        description: Coding system

      - name: value_quantity
        description: The information determined as a result of making the observation, if the information has a simple value

      - name: value_quantity_unit
        description: Unit of measure for the value_quantity

      - name: value_string
        description: The information determined as a result of making the observation, if the information is a string

      - name: value_boolean
        description: The information determined as a result of making the observation, if the information is a boolean

      - name: interpretation_code
        description: A categorical assessment of an observation value

      - name: interpretation_display
        description: Display value

      - name: interpretation_system
        description: Coding system

      - name: reference_range_low
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, low range

      - name: reference_range_high
        description: Guidance on how to interpret the value by comparison to a normal or recommended range, high range

      - name: reference_range_text
        description: Guidance on how to interpret the value by comparison to a normal or recommended range

      - name: effective_date
        description: Clinically relevant time/time-period for observation

      - name: issued_date
        description: Date/Time this version was made available

      - name: ingest_date
        description: Most recent ingest date
        tests:
          - not_null
          - is_date:
              date_format: yyyy-mm-dd HH24:MI:SS
              date_type: timestamp

      - name: client_id
        description: Strive client ID
        tests:
          - not_null
          - accepted_values:
              values: ['ssm','humana']
